<!-- pie.html ‚Äî versi√≥n con contadores (Workers) y versi√≥n del deploy desde /VERSION -->
<footer class="footer-strip">
  <img class="avatar" src="https://mellamollamacurso.github.io/lengua/inicial/a05.png" alt="avatar del profe" />
  <div class="footer-texts">
    <div class="footer-line1">Profe : √Ålex Barges</div>
    <div class="footer-sub">profesor y creador</div>
    <div class="footer-line2">
      <div class="course-name">Curso Cultura Hisp√°nica</div>
      <div class="version-badge" aria-label="versi√≥n del sitio">v‚Äî</div>
    </div>
    <div class="footer-legal">todos los derechos reservados</div>
  </div>

  <div id="llama-stats" aria-live="polite">
    <span>Total de llamas: <span class="val" id="stat-total">‚Äî</span></span>
    <span style="margin-left:24px">Llamas en l√≠nea: <span class="val" id="stat-online">‚Äî</span></span>
  </div>
</footer>

<script>
(function(){
  // ====== Versi√≥n del deploy (v0.30, v0.31, ...) desde un archivo est√°tico /VERSION ======
  (async function setVersionBadge(){
    var el = document.querySelector('.version-badge');
    if(!el) return;
    try{
      // Crie um arquivo texto chamado VERSION na raiz do reposit√≥rio (ex.: "v0.30")
      var r = await fetch('/VERSION', { cache:'no-store' });
      if(r.ok){
        var v = (await r.text()).trim();
        el.textContent = v || 'v‚Äî';
        return;
      }
    }catch(e){}
    // Fallback: mant√©m o valor atual ou usa lastModified se n√£o houver /VERSION
    if(el.textContent === 'v‚Äî'){
      var d = new Date(document.lastModified);
      var pad = function(n){ return String(n).padStart(2,'0'); };
      var vv = 'v' + String(d.getFullYear()).slice(2) + '.' + pad(d.getMonth()+1) + '.' + pad(d.getDate()) + '-' + pad(d.getHours()) + pad(d.getMinutes());
      el.textContent = vv;
    }
  })();

  // ====== Contadores (Cloudflare Workers) ‚Äî /visits, /online/in, /online, /online/out ======
  var elTotal  = document.getElementById('stat-total');
  var elOnline = document.getElementById('stat-online');
  if(!elTotal || !elOnline) return;

  // üîß SUBSTITUA pela URL real do seu Worker (ex.: https://mellamollama-contadores.seu-nome.workers.dev)
  var API = 'https://SEU-WORKER.workers.dev';

  var fmt = function(n){ return (n==null || isNaN(n)) ? '‚Äî' : new Intl.NumberFormat('es-ES').format(n); };

  async function jget(path, opts){
    var r = await fetch(API + path, Object.assign({ cache:'no-store', mode:'cors' }, opts || {}));
    if(!r.ok) throw new Error('http ' + r.status);
    return await r.json();
  }

  async function init(){
    if(!navigator.onLine){ elTotal.textContent = elOnline.textContent = '‚Äî'; return; }

    try{
      // /visits incrementa √öNICOS e devolve { value }
      var t = await jget('/visits');
      elTotal.textContent = fmt(t.value || 0);
    }catch(e){ elTotal.textContent = '‚Äî'; }

    try{
      // marca entrada online e l√™ total online
      await jget('/online/in', { method:'POST', keepalive:true });
      var on = await jget('/online');
      elOnline.textContent = fmt(on.value || 0);
    }catch(e){ elOnline.textContent = '‚Äî'; }

    // refresco peri√≥dico do "en l√≠nea"
    setInterval(async function(){
      if(!navigator.onLine) return;
      try{
        var on2 = await jget('/online');
        elOnline.textContent = fmt(on2.value || 0);
      }catch(e){}
    }, 15000);
  }

  // marca sa√≠da (melhor esfor√ßo)
  window.addEventListener('beforeunload', function(){
    try { navigator.sendBeacon(API + '/online/out'); } catch(e){}
  });

  window.addEventListener('online', init);
  window.addEventListener('load', init);
})();
</script>
