<div class="top-bar" aria-hidden="true"></div>
<img class="logo" src="{{ '/inicial/a03.gif' | relative_url }}" alt="Cultura Hispánica" />

<div class="menu-slot">
  <nav class="navbar" id="navbar">
    <ul class="nav-list" id="navList">
      <li class="nav-item has-dropdown" data-idx="0">
        <a class="nav-link" href="#">Inicio <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Conoce el curso</a></li>
          <li><a href="#" role="menuitem">Eventos</a></li>
          <li><a href="#" role="menuitem">Materiales</a></li>
        </ul></div>
      </li>
      <li class="nav-item has-dropdown" data-idx="1">
        <a class="nav-link" href="#">Alumno <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Ejercicios</a></li>
          <li><a href="#" role="menuitem">Pruebas</a></li>
          <li><a href="#" role="menuitem">Archivos</a></li>
        </ul></div>
      </li>
      <li class="nav-item has-dropdown" data-idx="2">
        <a class="nav-link" href="#">Profesor <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Libros</a></li>
          <li><a href="#" role="menuitem">Guías</a></li>
          <li><a href="#" role="menuitem">Asistencia</a></li>
        </ul></div>
      </li>
      <li class="nav-item has-dropdown" data-idx="3">
        <a class="nav-link" href="#">Contacto <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Agendar citas</a></li>
          <li><a href="#" role="menuitem">Dudas</a></li>
          <li><a href="#" role="menuitem">Test de nivel</a></li>
        </ul></div>
      </li>
    </ul>
    <span class="nav-underline" id="navUnderline"></span>
  </nav>
</div>
<div class="account" aria-label="acceder">
  <div class="avatar" aria-hidden="true"></div>
  <div class="acc-label">acceder</div>
</div>

<script>
(function(){
  var URL = "https://mellamollamacurso.github.io/lengua/guias/conoce_el_curso.html";

  // normaliza texto (sem acento, minúsculas)
  function norm(s){ return (s||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim(); }

  function wrapAsLink(el, href){
    var a = el.tagName==="A" ? el : el.querySelector("a");
    if(!a){
      a = document.createElement("a");
      a.style.textDecoration = "none";
      a.style.color = "inherit";
      a.draggable = false;
      while(el.firstChild){ a.appendChild(el.firstChild); }
      el.appendChild(a);
    }
    a.href = href;
    // se algum JS do menu “segura” o clique, garantimos a navegação:
    a.addEventListener("click", function(e){ e.stopImmediatePropagation(); }, true);
    return a;
  }

  function apply(){
    // procura contêiner do menu (tenta vários seletores comuns)
    var roots = document.querySelectorAll("#menu, nav#menu, nav[role='navigation'], nav, .menu");
    roots.forEach(function(root){
      var nodes = root.querySelectorAll("a, .nav-item, li, .submenu *");
      if(!nodes.length) nodes = root.querySelectorAll("*");
      nodes.forEach(function(el){
        var text = norm(el.textContent||"");
        if(text === "conoce el curso"){
          wrapAsLink(el, URL);
        }
      });
    });
  }

  if(document.readyState === "loading"){
    document.addEventListener("DOMContentLoaded", apply);
  } else {
    apply();
  }

  // fallback: se o menu é modificado por JS depois, reaplica
  new MutationObserver(apply).observe(document.documentElement, {subtree:true, childList:true});

  // ultra-fallback: qualquer clique em <a> dentro do menu navega mesmo se algum script bloquear
  document.addEventListener("click", function(ev){
    var a = ev.target.closest && ev.target.closest("#menu a, nav a, .menu a");
    if(a && a.href){ window.location.href = a.href; }
  }, true);
})();
</script>

<script>
(function(){
  const nav = document.getElementById('navbar');
  const ul  = document.getElementById('navList');
  const underline = document.getElementById('navUnderline');

  function setUnderline(li, instant=false){
    const c = nav.getBoundingClientRect();
    const r = li.getBoundingClientRect();
    const left  = r.left - c.left;
    const width = r.width;

    if (instant){
      const t = underline.style.transition;
      underline.style.transition = 'none';
      underline.style.left  = left  + 'px';
      underline.style.width = width + 'px';
      void underline.offsetWidth;
      underline.style.transition = t || 'left .15s,width .15s';
      return;
    }

    const a  = ul.querySelector('.nav-item.active') || li;
    const fr = a.getBoundingClientRect();
    const fl = fr.left - c.left;
    const frt= fl + fr.width;
    const tl = left;
    const tr = left + width;

    underline.style.transition = 'left .15s,width .15s';
    if (tl > fl){
      underline.style.left  = fl + 'px';
      underline.style.width = (tr - fl) + 'px';
      setTimeout(() => {
        underline.style.left  = tl + 'px';
        underline.style.width = width + 'px';
      }, 170);
    } else {
      underline.style.left  = tl + 'px';
      underline.style.width = (frt - tl) + 'px';
      setTimeout(() => {
        underline.style.width = width + 'px';
      }, 170);
    }
  }

  function closeAll(){ ul.querySelectorAll('.has-dropdown.open').forEach(li => li.classList.remove('open')); }

  ul.addEventListener('click', (e) => {
    const link = e.target.closest('.nav-link');
    if (!link) return;
    e.preventDefault();

    const li = link.closest('.nav-item');

    if (li.classList.contains('has-dropdown')){
      li.classList.toggle('open');
      ul.querySelectorAll('.has-dropdown').forEach(o => { if (o !== li) o.classList.remove('open'); });
      ul.querySelectorAll('.nav-item').forEach(it => it.classList.toggle('active', it === li));
      setUnderline(li);
      return;
    } else {
      closeAll();
    }

    ul.querySelectorAll('.nav-item').forEach(it => it.classList.toggle('active', it === li));
    setUnderline(li);
  });

  document.addEventListener('click', (e) => { if (!nav.contains(e.target)) closeAll(); });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeAll(); });

  window.addEventListener('load', () => {
    const active = ul.querySelector('.nav-item.active') || ul.querySelector('.nav-item');
    setUnderline(active, true);
  });
  window.addEventListener('resize', () => {
    const active = ul.querySelector('.nav-item.active') || ul.querySelector('.nav-item');
    setUnderline(active, true);
  });
})();
</script>
