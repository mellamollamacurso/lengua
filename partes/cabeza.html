<div class="top-bar" aria-hidden="true"></div>
<img class="logo" src="{{ '/inicial/a03.gif' | relative_url }}" alt="Cultura Hispánica" />

<div class="menu-slot">
  <nav class="navbar" id="navbar">
    <ul class="nav-list" id="navList">
      <li class="nav-item has-dropdown" data-idx="0">
        <a class="nav-link" href="#">Inicio <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Conoce el curso</a></li>
          <li><a href="#" role="menuitem">Eventos</a></li>
          <li><a href="#" role="menuitem">Materiales</a></li>
        </ul></div>
      </li>
      <li class="nav-item has-dropdown" data-idx="1">
        <a class="nav-link" href="#">Alumno <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Ejercicios</a></li>
          <li><a href="#" role="menuitem">Pruebas</a></li>
          <li><a href="#" role="menuitem">Materiales</a></li>
        </ul></div>
      </li>
      <li class="nav-item has-dropdown" data-idx="2">
        <a class="nav-link" href="#">Profesor <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Libros</a></li>
          <li><a href="#" role="menuitem">Guías</a></li>
          <li><a href="#" role="menuitem">Asistencia</a></li>
        </ul></div>
      </li>
      <li class="nav-item has-dropdown" data-idx="3">
        <a class="nav-link" href="#">Contacto <span class="caret"></span></a>
        <div class="popover" role="menu"><ul>
          <li><a href="#" role="menuitem">Agendar citas</a></li>
          <li><a href="#" role="menuitem">Dudas</a></li>
          <li><a href="#" role="menuitem">Test de nivel</a></li>
        </ul></div>
      </li>
    </ul>
    <span class="nav-underline" id="navUnderline"></span>
  </nav>
</div>
<div class="account" aria-label="acceder">
  <div class="avatar" aria-hidden="true"></div>
  <div class="acc-label">acceder</div>
</div>

<script>
(function(){
  const nav = document.getElementById('navbar');
  const ul  = document.getElementById('navList');
  const underline = document.getElementById('navUnderline');

  function setActive(li){
    ul.querySelectorAll('.nav-item').forEach(it => it.classList.toggle('active', it === li));
  }
  function moveUnderline(li, instant=false){
    const cr = nav.getBoundingClientRect();
    const r  = li.getBoundingClientRect();
    const left  = r.left - cr.left;
    const width = r.width;
    if (instant){
      const t = underline.style.transition;
      underline.style.transition = 'none';
      underline.style.left  = left+'px';
      underline.style.width = width+'px';
      void underline.offsetWidth;
      underline.style.transition = t || 'left .15s,width .15s';
    }else{
      underline.style.left  = left+'px';
      underline.style.width = width+'px';
    }
  }
  function closeAll(){ ul.querySelectorAll('.has-dropdown.open').forEach(li => li.classList.remove('open')); }

  ul.addEventListener('click',(e)=>{
    const link = e.target.closest('.nav-link');
    if(!link) return;
    e.preventDefault();
    const li = link.closest('.nav-item');
    if(li.classList.contains('has-dropdown')){
      li.classList.toggle('open');
      ul.querySelectorAll('.has-dropdown').forEach(o=>{ if(o!==li) o.classList.remove('open'); });
    }else{
      closeAll();
    }
    setActive(li);
    moveUnderline(li);
  });

  ul.addEventListener('mouseenter',(e)=>{
    const li = e.target.closest('.nav-item');
    if(li) moveUnderline(li);
  }, true);
  ul.addEventListener('mouseleave',()=>{
    const a = ul.querySelector('.nav-item.active') || ul.querySelector('.nav-item');
    moveUnderline(a);
  });

  document.addEventListener('click',(e)=>{ if(!nav.contains(e.target)) closeAll(); });
  document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeAll(); });

  window.addEventListener('load',()=>{
    const a = ul.querySelector('.nav-item.active') || ul.querySelector('.nav-item');
    setActive(a);
    moveUnderline(a, true);
  });
  window.addEventListener('resize',()=>{
    const a = ul.querySelector('.nav-item.active') || ul.querySelector('.nav-item');
    moveUnderline(a, true);
  });
})();
</script>
